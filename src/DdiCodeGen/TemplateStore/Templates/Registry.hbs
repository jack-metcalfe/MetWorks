// Registry
// {{GeneratedHeader}}
#nullable enable
using System.Threading.Tasks;

namespace {{GeneratedNamespace}}
{
    // The Registry class orchestrates the full lifecycle of all named instances.
    // Phase 1: Creation (synchronous)
    // Phase 2: Initialization (asynchronous)
    // Phase 3: Disposal (optional)
    public partial class {{RegistryClassName}}
    {
        // Phase 1: Creation (synchronous, safe).
        // Each instance is created via its dedicated InstanceFactory.
        // Element-driven and assignment-driven construction logic is encapsulated per instance.
        public void CreateAll()
        {
            {{#each Instances}}
                {{NamedInstanceName}}_InstanceFactory.Create(this);
            {{/each}}
        }

        // Phase 2: Initialization (async, potentially slow).
        // Only instances with assignments require async initialization.
        // Element-driven instances are fully constructed during creation.
        public async Task InitializeAllAsync()
        {
            {{#each Instances}}
                {{#if HasAssignments}}
                    await {{NamedInstanceName}}_Initializer.Initialize_{{NamedInstanceName}}Async(this);
                {{/if}}
            {{/each}}
        }

        // Phase 3: Disposal (optional).
        // Emitted only for instances that require cleanup.
        public void DisposeAll()
        {
            {{#each Instances}}
                {{#if HasDisposable}}
                    {{NamedInstanceName}}_Disposer.Dispose(this);
                {{/if}}
            {{/each}}
        }
    }
}
